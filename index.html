<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>穿搭建議隨機圖片（含性別選擇）</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    select, button, input { font-size: 16px; padding: 8px; margin: 5px 10px 5px 0; }
    #resultImage { margin-top: 20px; max-width: 400px; display: none; border: 1px solid #ccc; }
    label { font-weight: bold; }
    #favBtn { margin-top: 10px; }
    /* 測驗彈窗 */
    #quizSection {
      display:none; 
      position: fixed; 
      top: 50%; left: 50%; 
      transform: translate(-50%, -50%);
      background: #fff; 
      padding: 20px; 
      border: 2px solid #333; 
      box-shadow: 0 0 10px rgba(0,0,0,0.5); 
      z-index: 1000; 
      max-width: 400px;
    }
    #quizResult img {
      max-width: 300px; 
      border: 1px solid #ccc; 
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <!-- 名字輸入區 -->
  <div id="welcomeSection">
    <label for="usernameInput">請輸入你的名字：</label>
    <input type="text" id="usernameInput" placeholder="例如：小美" />
    <button onclick="saveUsername()">開始</button>
  </div>

  <h2 id="greeting" style="display:none;"></h2>

  <!-- 收藏按鈕 -->
  <button onclick="viewFavorites()">查看我的收藏</button>

  <h1>穿衣扭蛋機</h1>
  <p>請選擇場合與性別</p>

  <label for="selectGender">性別：</label>
  <select id="selectGender">
    <option value="" disabled selected>請選擇性別</option>
    <option value="male">男生</option>
    <option value="female">女生</option>
  </select>

  <label for="selectOption">場合：</label>
  <select id="selectOption">
    <option value="" disabled selected>請選擇場合</option>
    <option value="date">約會</option>
    <option value="summer">夏天</option>
    <option value="sport">運動</option>
    <option value="trip">旅遊</option>
    <option value="winter">冬天</option>
  </select>

  <button onclick="showRandomImage()">顯示隨機圖片</button>

  <div>
    <img id="resultImage" src="" alt="穿搭圖片" />
    <br />
    <button id="favBtn" style="display: none;" onclick="addToFavorites()">♡ 加入收藏</button>
  </div>

  <!-- 新增開始測驗按鈕 -->
  <button id="startQuizBtn" style="margin-top: 20px;">開始測驗</button>

  <!-- 測驗區塊 -->
  <div id="quizSection">
    <div id="quizQuestion" style="font-weight:bold; margin-bottom: 10px;"></div>
    <div id="quizOptions"></div>
    <button id="nextQuestionBtn" style="margin-top:10px;">下一題</button>
    <button id="closeQuizBtn" style="margin-top:10px; margin-left:10px;">關閉</button>
  </div>

  <!-- 測驗結果區 -->
  <div id="quizResult" style="display:none; margin-top: 20px;">
    <h3>你的風格測驗結果是：</h3>
    <p id="resultStyleName" style="font-weight:bold;"></p>
    <img id="resultStyleImage" src="" alt="測驗結果圖片" />
    <br>
    <button onclick="closeResult()">關閉結果</button>
  </div>

  <script>
    // 1. 儲存名字並顯示歡迎語
    function saveUsername() {
      const name = document.getElementById('usernameInput').value;
      if (name.trim() !== "") {
        localStorage.setItem("username", name);
        document.getElementById('greeting').textContent = `嗨~~~${name}，今天要去哪裡呢？`;
        document.getElementById('greeting').style.display = 'block';
        document.getElementById('welcomeSection').style.display = 'none';
      } else {
        alert("請輸入名字！");
      }
    }

    // 2. 頁面載入時自動讀名字
    window.onload = function () {
      const savedName = localStorage.getItem("username");
      if (savedName) {
        document.getElementById('greeting').textContent = `歡迎回來，${savedName}！今天要去哪裡呢？`;
        document.getElementById('greeting').style.display = 'block';
        document.getElementById('welcomeSection').style.display = 'none';
      }
    };

    // 3. 顯示圖片
    function showRandomImage() {
      const gender = document.getElementById('selectGender').value;
      const occasion = document.getElementById('selectOption').value;
      const img = document.getElementById('resultImage');

      const images = {
        male: {
          date: [
            'images/male/date/1.png',
            'images/male/date/2.png',
            'images/male/date/3.png'
          ],
          summer: [
            'images/male/summer/1.jpg',
            'images/male/summer/2.jpg',
            'images/male/summer/3.jpg'
          ],
          sport: [
            'images/male/sport/1.png',
            'images/male/sport/2.png',
            'images/male/sport/3.jpg'
          ],
          trip: [
            'images/male/trip/1.png',
            'images/male/trip/2.png',
            'images/male/trip/3.jpg'
          ],
          winter: [
            'images/male/winter/1.png',
            'images/male/winter/2.png',
            'images/male/winter/3.jpg'
          ]
        },
        female: {
          date: [
            'images/female/date/1.png',
            'images/female/date/2.png',
            'images/female/date/3.png'
          ],
          summer: [
            'images/female/summer/1.png',
            'images/female/summer/2.png',
            'images/female/summer/3.jpg'
          ],
          sport: [
            'images/female/sport/1.png',
            'images/female/sport/2.png',
            'images/female/sport/3.jpg'
          ],
          trip: [
            'images/female/trip/1.png',
            'images/female/trip/2.png',
            'images/female/trip/3.jpg',
            'images/female/trip/4.png',
            'images/female/trip/5.png',
            'images/female/trip/6.jpg',
            'images/female/trip/7.jpg'
          ],
          winter: [
            'images/female/winter/1.png',
            'images/female/winter/2.png',
            'images/female/winter/3.jpg'
          ]
        }
      };

      if (gender && occasion && images[gender] && images[gender][occasion]) {
        const pics = images[gender][occasion];
        const randomIndex = Math.floor(Math.random() * pics.length);
        const selectedImg = pics[randomIndex];

        img.src = selectedImg;
        img.alt = gender + ' ' + occasion + ' 穿搭圖片';
        img.style.display = 'block';
        document.getElementById('favBtn').style.display = 'inline-block';
      } else {
        img.style.display = 'none';
        document.getElementById('favBtn').style.display = 'none';
        alert('請先選擇性別與場合');
      }
    }

    // 4. 收藏功能
    function addToFavorites() {
      const img = document.getElementById('resultImage');
      const src = img.src;
      if (src) {
        let favs = JSON.parse(localStorage.getItem("favorites")) || [];
        if (!favs.includes(src)) {
          favs.push(src);
          localStorage.setItem("favorites", JSON.stringify(favs));
          alert("已加入收藏！");
        } else {
          alert("這張圖片已經在收藏清單中！");
        }
      }
    }

    // 5. 查看收藏
    function viewFavorites() {
      const favs = JSON.parse(localStorage.getItem("favorites")) || [];
      if (favs.length === 0) {
        alert("目前沒有收藏任何圖片");
        return;
      }
      let html = "<h2>我的收藏</h2>";
      favs.forEach(url => {
        html += `<img src="${url}" style="max-width:200px; margin:10px;" />`;
      });
      document.body.innerHTML = html + `<br><button onclick="location.reload()">回首頁</button>`;
    }

    // --- 測驗功能開始 ---

    const quizData = [
      {
        question: "你比較喜歡哪種顏色？",
        options: [
          { text: "黑色", style: "cool" },
          { text: "白色", style: "classic" },
          { text: "鮮豔色", style: "vibrant" }
        ]
      },
      {
        question: "你平常喜歡穿什麼風格？",
        options: [
          { text: "簡約時尚", style: "classic" },
          { text: "街頭潮流", style: "vibrant" },
          { text: "正式沉穩", style: "cool" }
]
}
];
    const styleImages = {
  classic: "images/style/classic.png",
  cool: "images/style/cool.png",
  vibrant: "images/style/vibrant.png"
};

let currentQuiz = 0;
let styleCount = { classic: 0, cool: 0, vibrant: 0 };

document.getElementById("startQuizBtn").onclick = function () {
  document.getElementById("quizSection").style.display = "block";
  loadQuizQuestion();
};

document.getElementById("closeQuizBtn").onclick = function () {
  document.getElementById("quizSection").style.display = "none";
};

document.getElementById("nextQuestionBtn").onclick = function () {
  const selected = document.querySelector('input[name="quizOption"]:checked');
  if (!selected) return alert("請選擇一個選項！");
  const selectedStyle = selected.value;
  styleCount[selectedStyle]++;

  currentQuiz++;
  if (currentQuiz < quizData.length) {
    loadQuizQuestion();
  } else {
    showQuizResult();
  }
};

function loadQuizQuestion() {
  const q = quizData[currentQuiz];
  document.getElementById("quizQuestion").textContent = q.question;
  const optionsHtml = q.options.map((opt, index) =>
    `<div><label><input type="radio" name="quizOption" value="${opt.style}"> ${opt.text}</label></div>`
  ).join('');
  document.getElementById("quizOptions").innerHTML = optionsHtml;
}

function showQuizResult() {
  document.getElementById("quizSection").style.display = "none";
  const resultStyle = Object.entries(styleCount).reduce((a, b) => a[1] > b[1] ? a : b)[0];
  document.getElementById("quizResult").style.display = "block";
  document.getElementById("resultStyleName").textContent = resultStyle === "classic" ? "經典風" : resultStyle === "cool" ? "酷帥風" : "亮眼風";
  document.getElementById("resultStyleImage").src = styleImages[resultStyle];
}

function closeResult() {
  document.getElementById("quizResult").style.display = "none";
  currentQuiz = 0;
  styleCount = { classic: 0, cool: 0, vibrant: 0 };
}

